<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="None">
  
  
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>My Project</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Home";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="js/jquery-2.1.1.min.js" defer></script>
  <script src="js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> My Project</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href=".">Home</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#hello-world">Hello, World!</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#language-features">Language features</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#closures">Closures</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#function-calls-without-parentheses">Function calls without parentheses</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#unseparated-arguments-colon-keyword-arguments">Unseparated arguments &amp; colon keyword arguments</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#dynamic-name-resolution-non-default">Dynamic name resolution (non-default)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#limitations">Limitations</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="changelog/">Changelog</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API Documentation</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="api-documentation/craftr.dsl/">craftr.dsl</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="api-documentation/craftr.dsl.rewrite/">craftr.dsl.rewrite</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="api-documentation/craftr.dsl.transpiler/">craftr.dsl.transpiler</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">My Project</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Home</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/Me/my-project/edit/master/docs/index.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="craftr-dsl">craftr-dsl</h1>
<p>The Craftr DSL is a transpiler for the Python language that introduces the concept of
<strong>closures</strong>, <strong>function calls without parentheses</strong> and a few other syntactical sugar
into the language. The language is a full superset of Python 3 code. The added syntax
features should only be used where it makes the code more readable or where it is
semantically more relevant.</p>
<h2 id="installation">Installation</h2>
<p>From Pip:</p>
<pre><code>$ pip install craftr-dsl[codegen,colors]
</code></pre>
<p>Latest from GitHub:</p>
<pre><code>$ pip install git+https://github.com/craftr-build/craftr-dsl
</code></pre>
<p>Requirements: Python 3.8 or newer</p>
<h2 id="hello-world">Hello, World!</h2>
<p>A convoluted Hello, World! example in Craftr DSL might look like this:</p>
<pre><code class="language-py"># hello.craftr
world = { self('World!') }
world { print('Hello,', self) }
</code></pre>
<p>This is transpiled to</p>
<pre><code class="language-py"># $ python -m craftr.dsl hello.craftr -E | grep -v -e '^$'
def _closure_1(self, *arguments, **kwarguments):
    self('World!')
world = _closure_1
def _closure_2(self, *arguments, **kwarguments):
    print('Hello,', self)
world(_closure_2)
</code></pre>
<p>And evaluates to</p>
<pre><code class="language-py"># $ python -m craftr.dsl hello.craftr
Hello, World!
</code></pre>
<h2 id="language-features">Language features</h2>
<p>The Craftr DSL grammar and code generator can be configured to an extend to turn some
language features and semantics on and off. What will be shown below in most examples
is compatible with the default configuration unless otherwise noted.</p>
<h3 id="closures">Closures</h3>
<p>Closures are formed with the following syntax: <code>[ arg -&gt; | (arg1, arg2, ...) -&gt; ] { body }</code>. A closure without
an argument list automatically has the signature <code>(self, *argnames, **kwargnames)</code>.</p>
<table align="center"><tr><th>Craftr DSL</th><th>Python</th></tr>

<tr><td>


<pre><code class="language-py">filter({ self % 2 }, range(5))
</code></pre>

</td><td>


<pre><code class="language-py">def _closure_1(self, *argnames, **kwargnames):
    self % 2
filter(_closure_1, range(5))
</code></pre>

</td></tr>


<tr><td>


<pre><code class="language-py">filter(x -&gt; x % 2, range(5))
</code></pre>

</td><td>


<pre><code class="language-py">def _closure_1(x):
    return x % 2
filter(_closure_1, range(5))
</code></pre>

</td></tr>


<tr><td>


<pre><code class="language-py">reduce((a, b) -&gt; {
  a.append(b * 2)
  return a
}, [1, 2, 3], [])
</code></pre>

</td><td>


<pre><code class="language-py">def _closure_1(a, b):
    a.append(b * 2)
    return a
reduce(_closure_1, [1, 2, 3], [])
</code></pre>

</td></tr>

</table>

<h3 id="function-calls-without-parentheses">Function calls without parentheses</h3>
<p>Such function calls are only supported at the statement level. A function can be called without parentheses by
simply omitting them. Variadic and keyword arguments are supported as expected. Applying a closure on an object
is basically the same as calling that object with the function, and arguments following the closure are still
supported.</p>
<table align="center"><tr><th>Craftr DSL</th><th>Python</th></tr>

<tr><td>


<pre><code class="language-py">print 'Hello, World!', file=sys.stderr
</code></pre>

</td><td>


<pre><code class="language-py">print('Hello, World!', file=sys.stderr)
</code></pre>

</td></tr>


<tr><td>


<pre><code class="language-py">map {
  print('Hello,', self)
}, ['John', 'World']
</code></pre>

</td><td>


<pre><code class="language-py">def _closure_1(self, *arguments, **kwarguments):
    print('Hello,', self)
map(_closure_1, ['John', 'World'])
</code></pre>

</td></tr>

</table>

<h3 id="unseparated-arguments-colon-keyword-arguments">Unseparated arguments &amp; colon keyword arguments</h3>
<p>The Craftr DSL allows passing arguments to function calls without separation by commas.
Keyword arguments may be specified using colons (<code>:</code>) instead of equal signs (<code>=</code>).</p>
<table>

<tr><th>Craftr DSL</th><th>Python</th></tr>

<tr><td>


<pre><code class="language-py">print 'Hello, World!' 42 * 1 + 10 file: sys.stdout
</code></pre>

</td><td>


<pre><code class="language-py">print('Hello, World!', 42 * 1 + 10, file=sys.stdout)
</code></pre>

</td></tr>


<tr><td>


<pre><code class="language-py">task &quot;hello_world&quot; do: {
  print &quot;Hello, World!&quot;
}
</code></pre>

</td><td>


<pre><code class="language-py">def _closure_1(self, *arguments, **kwarguments):
    print('Hello, World!')
task('hello_world', do=_closure_1)
</code></pre>

</td></tr>


<tr><td>


<pre><code class="language-py">list(map {
  print('Hello,', self)
}, ['John', 'World'])
</code></pre>


> **Note**: Pitfall, this actually passes three arguments to `list()`.
</td><td>


<pre><code class="language-py">def _closure_1(self, *arguments, **kwarguments):
    print('Hello,', self)
list(map, _closure_1, ['John', 'World'])
</code></pre>

</td></tr>

</table>

<h3 id="dynamic-name-resolution-non-default">Dynamic name resolution <sup>(non-default)</sup></h3>
<p>For some purposes and applications, dynamic name resolution may be desirable, for
example when writing <code>self</code> in front of every name to access a property of the closure
target object. For this, the Craftr DSL transpiler can generate code that looks up,
sets and deletes keys using subscript syntax on a particular variable name.</p>
<p>Using the <code>craftr.dsl.runtime</code> package, you can configure the transpiler and runtime
to use dynamic name resolution. Example usage:</p>
<pre><code class="language-py">from craftr.dsl.transpiler import transpile_to_ast
from craftr.dsl.runtime import Closure

class Project:
  def task(self, name: str, *, do: callable): ...

module = transpile_to_ast(craftr_dsl_code, filename, Closure.get_options())
code = compile(module, filename, 'exec')
scope = {'__closure__': Closure(None, None, Project())}
exec(code, scope)
</code></pre>
<p>The <code>Closure.get_options()</code> function returns <code>TranspileOptions</code> that instruct the transpiler
to convert name lookups into subscripts on the <code>__closure__</code> variable, add a
<code>@__closure__.child</code> decoration before every closure function definition and to add a
<code>__closure__,</code> argument to their arglist. The <code>Closure</code> object passed into the <code>scope</code>
on execution deals with the rest.</p>
<table>

<tr><th>Craftr DSL</th><th>Python</th></tr>

<tr><td>


<pre><code class="language-py">task &quot;foobar&quot; do: {
  return n_times
}

task &quot;belzebub&quot; do: {
  def n_times = 1
  return n_times
}

task &quot;cheeky&quot; do: {
  def n_times = 1
  return (() -&gt; n_times )()
}
</code></pre>

</td><td>


<pre><code class="language-py">@__closure__.child
def _closure_1(__closure__, self, *arguments, **kwarguments):
    return __closure__['n_times']
__closure__['task']('foobar', do=_closure_1)

@__closure__.child
def _closure_2(__closure__, self, *arguments, **kwarguments):
    n_times = 1
    return n_times
__closure__['task']('belzebub', do=_closure_2)

@__closure__.child
def _closure_3(__closure__, self, *arguments, **kwarguments):
    n_times = 1
    @__closure__.child
    def _closure_3_closure_3(__closure__):
        return n_times
    return _closure_3_closure_3()
__closure__['task']('cheeky', do=_closure_3)
</code></pre>


</td></tr>

</table>

<h3 id="limitations">Limitations</h3>
<p>Craftr DSL is intended to behave as a complete syntactic superset of standard Python. However there are currently
some limitations, namely:</p>
<ul>
<li>Literal sets cannot be expressed due to the grammar conflict with parameter-less closures</li>
<li>Type annotations are not currently supported</li>
<li>The walrus operator is not currently supported</li>
<li>Function calls without parenthesis do not support passing <code>*args</code> as the first argument as that is
  interpreted as a multiplication expression.</li>
</ul>
<hr />
<p align="center">Copyright &copy; 2021 Niklas Rosenstein</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="changelog/" class="btn btn-neutral float-right" title="Changelog">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/Me/my-project/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
      <span><a href="changelog/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.2.2
Build Date UTC : 2021-09-28 09:14:54.103473+00:00
-->
